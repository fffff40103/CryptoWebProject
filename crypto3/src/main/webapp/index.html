<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
	<title>Stock Socket Demo</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
	<script>
		$(function() {
			$.ajax({
		        url: 'http://localhost:8080/crypto2/mvc/crypto/send',
		        success: function ( data ){
					console.log(data);
		        }
		    });
		});
		
		var socket = new WebSocket('ws://localhost:8080/crypto2/mvc/websocket');

		socket.onopen = function(event) {
		    console.log('WebSocket連線已建立');
		    console.log(event)

		};
		
		socket.onmessage=function(event){
			let message = JSON.parse(event.data);
			if(message.type === 'initial' ){
				console.log(message.content);
				let test=message.content
				let h1=document.querySelector("h1");
				var pattern = /\[ name=(\w+), price=([0-9.]+), value=(\w+), rate=([0-9.]+)\]/;
				var match = test.match(pattern);
				var name = match[1];
			    var price = match[2];
			    var value = match[3];
			    var rate = match[4];
			    h1.innerText=name;
				console.log(name);
   				 console.log("name=" + name + ", price=" + price + ", value=" + value + ", rate=" + rate);
			}else{
				let cryptos=message.content;
				console.log(cryptos)
				let h1=document.querySelector("h1");
				h1.innerText=cryptos[1].name;
			}
			
			
		
			
		
		}
		
		
		socket.onclose = function() {
		    console.log('WebSocket連線已關閉');
		};
		
	</script>
</head>
<body>
	<h1 class="h1">Hi</h1>
	
</body>
</html>